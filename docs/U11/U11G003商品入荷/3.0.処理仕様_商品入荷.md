# 処理仕様_商品入荷

## 登録

- 画面入力内容をもとに$商品入荷をデータベースに登録する。

### データ存在検証

エラー条件

- 画面.部署コード:-部署が存在しない
- 画面.入荷先コード:-入荷先が存在しない
- 画面.明細リスト_入荷-:商品コード:-商品が存在しない

### $商品入荷構築

$商品入荷

- 入荷先=画面.入荷先コード:-入荷先
- 商品移動入荷=下記参照
- 訂正明細リスト=不要

商品移動入荷

- 部署=画面.部署コード:-部署
- 日付=部署.営業日
- 区分=入荷
- タイムスタンプ=現在日付時刻
- 商品移動明細リスト
    - 明細番号=採番（1〜）
    - 商品=画面.明細リスト_入荷-:商品コード:-商品
    - 移動数=画面.明細リスト_入荷-:入荷数

### 処理可否検証

下記参照

### $商品入荷の業務整合性検証

エラー条件

- $商品入荷.商品移動明細.移動数が0・マイナス
    - $商品入荷.商品移動明細.移動数 < 1
- $商品入荷.商品移動明細で同じ商品を含む

### $商品入荷の保存

- 商品移動テーブル
- 商品移動明細テーブル
- 商品移動入荷テーブル

***

## 更新

- 画面入力内容をもとに登録済みの$商品入荷を更新する
- 更新対象:$商品入荷.商品移動明細リストのみ
    - 画面.明細リスト_入荷を更新対象とする
    - 画面.ヘッダは更新対象としない
- 排他制御対象レコード
    - 商品移動入荷テーブル

### データ存在検証

エラー条件

- 画面.明細リスト_入荷-:商品コード:-商品が存在しない

### $商品入荷構築

同上

### 処理可否検証

下記参照

### $商品入荷の業務整合性検証

同上

### $商品入荷の更新時整合性検証

エラー条件

- 営業日が変わり、入荷日を過ぎている
    - $商品入荷.入荷日 != $商品入荷.部署.営業日
- 商品移動の更新の結果、商品の在庫数がマイナスになる
    - [マイナス商品在庫](/u11/仕様/マイナス商品在庫)

### $商品入荷の保存

同上

***

## 削除

- 登録済みの$商品入荷を削除する。
- 排他制御対象レコード
    - 商品移動入荷テーブル

### 処理可否検証

下記参照

### $商品入荷の削除時整合性検証

エラー条件

- 営業日が変わり、入荷日を過ぎている。
    - $商品入荷.入荷日 != $商品入荷.部署.営業日
- 商品移動の削除の結果、商品の在庫数がマイナスになる
    - [マイナス商品在庫](/u11/仕様/マイナス商品在庫)

### $商品入荷の削除

- 商品移動テーブル
- 商品移動明細テーブル
- 商品移動入荷テーブル

***

## 処理可否検証

### 排他制御

- $商品入荷.部署が棚卸中の場合エラー
    - [商品棚卸中](/U11/仕様/商品棚卸中)

### ユーザー権限チェック

- $商品入荷.部署がユーザーの部署と異なる場合エラー
    - ユーザー:-社員.所属部署 != $商品入荷.部署

***

## ヘッダ整合性検証

エラー条件

- 画面.部署コード:-部署が存在しない
- 画面.入荷先コード:-入荷先が存在しない

## 明細整合性検証

エラー条件

- 画面.明細リスト_入荷-:商品コード:-商品が存在しない
