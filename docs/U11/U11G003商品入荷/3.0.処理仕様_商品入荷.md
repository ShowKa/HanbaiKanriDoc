# 商品入荷処理仕様

***

## 商品入荷登録

- 当日営業日における$商品移動入荷を登録する。

### 商品移動入荷構築

以下を$商品移動入荷とする。

- 部署=form.部署コード:-部署
- 入荷先=form.入荷先コード:-入荷先
- 入荷日=form.部署コード:-部署:-営業日
- 明細リスト
  - 商品=form.明細.商品コード:-商品
  - 移動数=form.明細.移動数

### データ存在検証

- $商品移動入荷.部署が存在しない場合、エラー
- $商品移動入荷.入荷先が存在しない場合、エラー
- $商品移動入荷.明細.商品が存在しない場合、エラー

### 処理可否検証

- 下記参照

### $商品移動入荷の業務整合性検証

- $商品移動入荷.明細.移動数<=0の場合、エラー
- $商品移動入荷.明細.商品が[明細内重複](/共通/明細内重複)する場合、エラー

### $商品移動入荷の保存

#### $商品移動の整合性検証

- なし

#### テーブル登録

- 商品移動テーブル
- 商品移動明細テーブル
- 商品移動入荷テーブル

***

## 商品入荷更新

- $商品移動入荷を修正し、更新する。
- 当日営業日に登録した$商品移動入荷が対象。
- 更新対象
  - $商品移動入荷.明細のみ

### データ存在検証

- $商品移動入荷.明細.商品が存在しない場合、エラー

### 処理可否検証

- 下記参照

### $商品移動入荷の業基本務整合性検証

- $商品移動入荷.明細.移動数<=0の場合、エラー
- $商品移動入荷.明細.商品が[明細内重複](/共通/明細内重複)する場合、エラー

### $商品移動入荷の更新時整合性検証

- $商品移動入荷.入荷日 != $商品移動入荷.部署:-営業日の場合、エラー

### $商品移動入荷の保存

#### $商品移動の整合性検証

- [マイナス商品在庫](/u11/仕様/マイナス商品在庫)となる場合、エラー

#### テーブルレコードの削除・更新

- 商品移動明細テーブル

***

## 商品入荷削除

- $商品移動入荷を削除する。
- 当日営業日に登録した$商品移動入荷が対象。

### 処理可否検証

- 下記参照

### $商品移動入荷の削除時整合性検証

- $商品移動入荷.入荷日 != $商品移動入荷.部署:-営業日の場合、エラー

### $商品移動入荷の削除

#### $商品移動の整合性検証

- [マイナス商品在庫](/u11/仕様/マイナス商品在庫)となる場合、エラー

#### テーブルレコード削除

- 商品移動テーブル
- 商品移動明細テーブル
- 商品移動入荷テーブル

***

## 参照モード

### $商品入荷の取得

***

## 新規登録モード

***

## 更新モード

***

## 処理可否検証

### 排他制御

- $商品移動入荷.部署が[商品棚卸中](/U11/仕様/商品棚卸中)の場合、エラー

### ユーザー権限チェック

- ユーザー:-社員.所属部署 != $商品移動入荷.部署の場合、エラー
