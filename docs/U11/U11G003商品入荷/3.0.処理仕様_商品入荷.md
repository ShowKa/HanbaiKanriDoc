# 処理仕様_商品入荷

## 登録

- 画面入力内容をもとに$商品入荷をデータベースに登録する。

### $商品入荷構築

$商品入荷
- 入荷先=画面.入荷先コード:-入荷先
- 商品移動入荷=下記参照
- 訂正明細リスト=不要

商品移動入荷
- 部署=画面.部署コード:-部署
- 日付=部署.営業日
- 区分=入荷
- タイムスタンプ=現在日付時刻
- 商品移動明細リスト
    - 明細番号=採番（1〜）
    - 商品=画面.明細.商品コード:-商品
    - 移動数=画面.明細.入荷数

### データ存在検証

エラー条件
- $商品入荷.部署が存在しない
- $商品入荷.入荷先が存在しない
- $商品入荷.商品移動明細.商品が存在しない

### 処理可否検証

下記参照

### $商品入荷の業務整合性検証

エラー条件
- $商品入荷.商品移動明細.移動数<=0
- $商品入荷.商品移動明細.商品が明細内重複する

### $商品入荷の保存

- 商品移動テーブル
- 商品移動明細テーブル
- 商品移動入荷テーブル

***

## 更新

画面入力内容をもとに登録済みの$商品入荷を更新する。
- 更新対象:$商品入荷.商品移動明細リストのみ
- 排他制御:商品移動テーブル

### $商品入荷構築

同上

### データ存在検証

エラー条件
- $商品入荷.明細.商品が存在しない

### 処理可否検証

下記参照

### $商品入荷の業務整合性検証

同上

### $商品入荷の更新時整合性検証

エラー条件
- $商品入荷.入荷日 != $商品入荷.部署.営業日
- [マイナス商品在庫](/u11/仕様/マイナス商品在庫)

### $商品入荷の保存

同上

***

## 削除

- $商品入荷をデータベースから削除する。
- 排他制御:商品移動テーブル

### 処理可否検証

下記参照

### $商品入荷の削除時整合性検証

エラー条件
- $商品入荷.入荷日 != $商品入荷.部署.営業日
- [マイナス商品在庫](/u11/仕様/マイナス商品在庫)

### $商品入荷の削除

- 商品移動テーブル
- 商品移動明細テーブル
- 商品移動入荷テーブル

***

## 処理可否検証

### 排他制御

エラー条件
- $商品入荷.部署が[商品棚卸中](/U11/仕様/商品棚卸中)

### ユーザー権限チェック

エラー条件
- ユーザー:-社員.所属部署 != $商品入荷.部署
