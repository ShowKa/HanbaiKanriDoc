# 商品入荷訂正処理仕様

***

## 商品入荷訂正登録

- 商品入荷登録後、翌営業日以降に商品入荷を訂正する。
- $登録済商品移動入荷を更新せず、新たに$商品移動入荷訂正を登録する。
  - 入荷数を1つ減らす場合、「入荷日=訂正する営業日 & 移動数=-1」の$商品移動を登録する。
- 訂正を再度修正する場合は、$登録済商品移動入荷訂正を更新・削除する。
- 訂正後の翌日以降に再度訂正する場合は、新たに$商品移動入荷訂正を登録する。
  - $商品移動入荷訂正が2件以上となる。
- 訂正対象
  - $商品移動入荷.明細のみ

### 処理可否検証

- 下記参照

### $商品移動入荷の訂正登録時整合性検証

- $商品移動入荷.入荷日 = $商品移動入荷.部署:-営業日の場合、エラー
- $商品移動入荷.明細.商品が[商品棚卸済](/U11/仕様/商品棚卸済)の場合、エラー

### $商品移動入荷訂正の登録

#### $商品移動の整合性検証

- [マイナス商品在庫](/U11/仕様/マイナス商品在庫)となる場合、エラー

#### テーブルレコードの保存

- 商品移動テーブル
- 商品移動明細テーブル
- 商品移動入荷訂正テーブル

***

## 商品入荷訂正更新

- 商品入荷訂正登録後、当日営業日のうちに商品入荷訂正を修正し、更新する。
  - 訂正内容が間違っていたのでそれを修正する。

基本的に登録と同じなので記載省略。

***

## 商品入荷訂正削除

### 処理可否検証

- 下記参照

### $商品移動入荷の訂正削除時整合性検証

- XXX不要? $商品移動入荷訂正済ではない場合、エラー

### $商品移動入荷訂正の削除

#### $商品移動の整合性検証

- [マイナス商品在庫](/U11/仕様/マイナス商品在庫)となる場合、エラー

#### テーブルレコードの削除

- 商品移動テーブル
- 商品移動明細テーブル
- 商品移動入荷訂正テーブル

***

### 訂正登録モード

***

### 訂正更新モード

***

## 処理可否検証

### 排他制御

- $商品移動入荷.部署が[商品棚卸中](/U11/仕様/商品棚卸中)の場合、エラー

### ユーザー権限チェック

- ユーザー:-社員.所属部署 != $商品移動入荷.部署の場合、エラー
