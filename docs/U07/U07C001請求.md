U07C001売掛請求

XXX 現金顧客の掛売（「臨時掛売」と呼称）の請求は考慮していない。

# [u07C001_001]締日が到来した顧客宛の請求書を作成したい

- 理由：売掛金を請求し、入金してもらうため。

詳細仕様

- 入力:$部署、$営業日

## U07C001 請求
SeikyuUrikakeCrudService#seikyu($部署, $営業日)

### $営業日を基準にして$締日リスト取得
ShimeDateBusinessService.getShimeDate($営業日)

$締日リスト：

- $営業日を含む。
	- ただし$営業日.年月日.日=31の場合、31の値は含めない。
- $営業日.翌日が非営業日の場合、翌日も$締日リストに含む。
- $営業日.翌々日が非営業日の場合、翌々日も$締日リストに含める（以降繰り返し）。
	- ただし営業日となった場合は、それ以上含める必要はない。
	- 31も含めない。
- $営業日=月末日 & $営業日<30の場合、$営業日〜30までの値も含める。

例：

- $営業日=2018/02/09（金）の場合、$締日リスト=[9, 10, 11]
	- 10, 11は土、日で非営業日。
	- 12は月曜日で営業日。
- $営業日=2018/02/28（水）の場合、$締日リスト=[28, 29, 30]
- $営業日=2018/07/31（火）の場合、$締日リスト=なし
	- 請求処理そのものが不要となる。
- $営業日=2018/08/31（金）の場合、$締日リスト=[1, 2]
	- 翌日9/1, 9/2 が非営業日のため含める。

### 顧客Tableから締日の$顧客リストを取得
NyukinKakeInfoSearchService#getKokyakuOnShimeDate($部署, $締日リスト)

条件：

- 顧客.主幹部署=$部署
- 締日が到来している顧客である。
	- 顧客:-入金掛売情報.締日 ∈ $締日リスト

### 売掛Tableから$顧客の請求対象の$売掛リスト取得
UrikakeSearchService#getUrikakeForSeikyu($顧客)

#### $売掛リスト未請求取得

- $顧客の売掛である
	- 売掛:-売上:-顧客 = $顧客
- 未請求
	- 請求中売掛Tableにレコードが存在しない
	- [消込未完了]()

#### $売掛リスト入金延滞分取得

- $顧客の売掛である
	- 売掛:-売上:-顧客 = $顧客
- 請求中 & 入金延滞している
	- 請求中売掛Tableにレコードが存在
	- 請求中売掛:-請求.支払日 <= $営業日

### $顧客 & $売掛リストから$請求仕様を構築

$請求仕様：

- 顧客=$顧客
- 請求日=$営業日
- 支払日=[$顧客.入金予定日](/)
- 請求明細
	- 売掛=$売掛
	- 請求金額=[$売掛.残高]()

### $請求を請求Tableに登録
SeikyuCrudService#save($請求仕様);

- 請求Table登録
- 請求明細Table登録

# [u07C001_002] 請求書再作成

- 顧客と期間を指定し、その間の売上の売掛を請求対象とする。
- すでに請求中とか関係なく、対象になる。
- 消込されていなければ対象となる。消込完了の場合、請求対象外。
- ただしあくまで請求書を作成するというだけで、売掛の入金予定日や請求中売掛を更新はしない。
- 請求締め日、支払日はユーザーの任意で指定可能。

# 売掛未請求仕様
